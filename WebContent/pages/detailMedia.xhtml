<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" 
	xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core" 
    xmlns:ui="http://java.sun.com/jsf/facelets" 
    xmlns:a4j="http://richfaces.org/a4j"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:p="http://primefaces.org/ui">    
    <!--xmlns:c="http://java.sun.com/jstl/core"-->
    
<f:metadata>
	<f:viewParam name="v" value="#{beanMedia.idMediaVisualise}" />
	<f:event type="preRenderView" listener="#{beanMedia.processMediaPre()}" onPostback="false" />
</f:metadata>

<ui:composition template="/templates/standard.xhtml">
	<ui:define name="pageTitle">Détail d'un média</ui:define>
	<ui:define name="content">
		<section class="group1">
			<div id="fb-root"></div>
			<script>(function(d, s, id) {
			  var js, fjs = d.getElementsByTagName(s)[0];
			  if (d.getElementById(id)) return;
			  js = d.createElement(s); js.id = id;
			  js.src = "//connect.facebook.net/fr_FR/all.js#xfbml=1";
			  fjs.parentNode.insertBefore(js, fjs);
			}(document, 'script', 'facebook-jssdk'));
			</script>
		    
			<h3>Détail d'un média</h3>
			
			<br />
			
			<h:outputText rendered="#{empty beanMedia.utilisateurConnecte}" value="Vous devez être connecté pour accéder à cette page" />
		    
		    <br />
		    		
			<h:outputText value="#{beanMedia.titreMedia}" styleClass="titre" />
						
			<br />
			<br />
			<br />
						
			<!-- surrounding element with class - needed!! -->
			<h:panelGroup rendered="#{beanMedia.nomTypeMedia == 'Video' }">
				<div onclick="incrementerNbVues()" class="leanback-player-video" style="z-index: 0;">
			    
				<!-- Lecteur vidéo -->
			    <!-- HTML5 <video> element -->
			       <video width="612" height="404" preload="metadata" poster="../resources/videos/elephants_dream_640x360.jpg"> <!--  width="472" height="264" -->
				        <!-- HTML5 <video> sources -->
				        <source src="../resources/videos/elephants_dream_640x360_2.30.mp4" type='video/mp4; codecs="avc1.42E01E, mp4a.40.2"'/>
		<!--		    <source src="../resources/videos/360p/elephants_dream_640x360_2.30.mp4" type='video/mp4; codecs="avc1.42E01E, mp4a.40.2"'/>
		 	       		<source src="../resources/videos/480p/elephants_dream_856x480_2.30.mp4" type='video/mp4; codecs="avc1.42E01E, mp4a.40.2"'/>
				        <source src="../resources/videos/720p/elephants_dream_1280x720_2.30.mp4" type='video/mp4; codecs="avc1.42E01E, mp4a.40.2"'/>
		-->
						<source src="../resources/videos/elephants_dream_640x360_2.30.webm" type='video/webm; codecs="vp8, vorbis"'/>       
		<!--			<source src="../resources/videos/360p/elephants_dream_640x360_2.30.webm" type='video/webm; codecs="vp8, vorbis"'/>
				    	<source src="../resources/videos/480p/elephants_dream_856x480_2.30.webm" type='video/webm; codecs="vp8, vorbis"'/>
				        <source src="../resources/videos/720p/elephants_dream_1280x720_2.30.webm" type='video/webm; codecs="vp8, vorbis"'/>
		-->		        
						<source src="../resources/videos/elephants_dream_640x360_2.30.ogv" type='video/ogg; codecs="theora, vorbis"'/>
		 <!--		    <source src="../resources/videos/360p/elephants_dream_640x360_2.30.ogv" type='video/ogg; codecs="theora, vorbis"'/>
		 		  		<source src="../resources/videos/480p/elephants_dream_856x480_2.30.ogv" type='video/ogg; codecs="theora, vorbis"'/>
			    		<source src="../resources/videos/720p/elephants_dream_1280x720_2.30.ogv" type='video/ogg; codecs="theora, vorbis"'/>
		-->	
				    	<!-- subtitle-references with <track>-element -->
		 				<!--<track enabled="true" kind="subtitles" label="????" srclang="ar" type="text/x-srt" src="../resources/subtitles/elephants_dream/arabic_ar.srt"></track>
						<track enabled="true" kind="subtitles" label="??" srclang="zh" type="text/x-srt" src="../resources/subtitles/elephants_dream/chinese_zh.srt"></track>
						<track enabled="true" kind="subtitles" label="Deutsch" srclang="de" type="text/x-srt" src="../resources/subtitles/elephants_dream/german_de.srt"></track>
						<track enabled="true" kind="subtitles" label="English" srclang="en" type="text/x-srt" src="../resources/subtitles/elephants_dream/english_en.srt"></track>
		 				<track enabled="true" kind="subtitles" label="Español" srclang="es" type="text/x-srt" src="../resources/subtitles/elephants_dream/spanish_es.srt"></track>
						<track enabled="true" kind="subtitles" label="Français" srclang="fr" type="text/x-srt" src="../resources/subtitles/elephants_dream/french_fr.srt"></track>
						<track enabled="true" kind="subtitles" label="???" srclang="ja" type="text/x-srt" src="../resources/subtitles/elephants_dream/japanese_ja.srt"></track>
						<track enabled="true" kind="subtitles" label="Svenska" srclang="sv" type="text/x-srt" src="../resources/subtitles/elephants_dream/svenska_sv.srt"></track>-->
					    
					    <!-- Flash-Fallback -->
				   		<object class="leanback-player-flash-fallback" width="472" height="259" type="application/x-shockwave-flash" data="../resources/flash/flowplayer-3.2.7.swf">
				            <param name="movie" value="../resources/flash/flowplayer-3.2.7.swf" />
							<param name="allowfullscreen" value="true" />
							<param name="bgcolor" value="#000000" />
							<param name="flashvars" value='config={"clip":{"url":"../resources/videos/elephants_dream_640x360_2.30.mp4","autoPlay":false,"autoBuffering":false}}' />
							<!--<param name="flashvars" value='config={"clip":{"url":"../resources/videos/360p/elephants_dream_640x360_2.30.mp4","autoPlay":false,"autoBuffering":false}}' />-->
				        </object>
				 
				        <!-- HTML-Fallback - Download Links -->
				        <div class="leanback-player-html-fallback">
				            <img src="../resources/videos/elephants_dream_640x360.jpg" width="360" height="240" alt="Poster Image" 
				                title="No HTML5 media playback capabilities available." />
				            <div>
				                <strong>Download Video:</strong>
				                <a href="../resources/videos/elephants_dream_640x360_2.30.mp4">.mp4</a>,
				                <a href="../resources/videos/elephants_dream_640x360_2.30.webm">.webm</a>,
				                <a href="../resources/videos/elephants_dream_640x360_2.30.ogv">.ogv</a>
				                <!--<a href="../resources/videos/360p/elephants_dream_640x360_2.30.mp4">.mp4</a>,
				                <a href="../resources/videos/360p/elephants_dream_640x360_2.30.webm">.webm</a>,
				                <a href="../resources/videos/360p/elephants_dream_640x360_2.30.ogv">.ogv</a>-->
				            </div>
				        </div>
				    </video>
			</div>
			
			<br />
			<br />
			<!--<p:media value="http://www.youtube.com/v/KZnUr8lcqjo" width="425" height="344" player="flash"/>-->
			</h:panelGroup>
			
			
			<br /><br /><br />
				
		
			<h:panelGroup rendered="#{beanMedia.nomTypeMedia == 'Son'}">
				<!-- surrounding element with class - needed!! -->
				<div class="leanback-player-audio" style="width:612px; z-index: 0;"><!-- width="350px" -->
				    <!-- Lecteur audio -->
				    <!-- HTML5 <audio> element -->
				    <audio preload="metadata">
				        <!-- HTML5 <audio> sources -->
				        <source src="../resources/audios/03_Snowflake_GiveItUp_4.19.mp4" type='audio/mp4; codecs="mp4a.40.2"'/>
				        <source src="../resources/audios/03_Snowflake_GiveItUp_4.19.mp3" type='audio/mpeg; codecs="vorbis"'/>
				        <source src="../resources/audios/03_Snowflake_GiveItUp_4.19.oga" type='audio/ogg; codecs="vorbis"'/>
				    
				    	<!-- HTML-Fallback - Download Links -->
				        <div class="leanback-player-html-fallback">
				            <div>
				                <strong>Download Audio:</strong>
				                <a href="../resources/audios/03_Snowflake_GiveItUp_4.19.mp4">.mp4</a>
				                <a href="../resources/audios/03_Snowflake_GiveItUp_4.19.mp3">.mp3</a>
				                <a href="../resources/audios/03_Snowflake_GiveItUp_4.19.oga">.oga</a>
				            </div>
				        </div>
				    </audio>
				</div>
			</h:panelGroup>
			
			
		
		<!-- S'abonner et Se désabonner XXX -->

		
		<!-- Partie gauche -->
		<p:fieldset styleClass="gauche">  
		<h:form>
		
		<!-- Actions possibles -->
		<p:growl id="messages"/>  
  
	    <p:splitButton id="avis" value="Avis" icon="ui-icon-person" style="font-size: 11px;">  
	        <p:menuitem id="jAime" value="J'aime" actionListener="#{beanMedia.jAime}" update="messages, avis" icon="ui-icon-heart" disabled="#{beanMedia.jAimeDisabled}" />
	        <p:menuitem id="jeNAimePas" value="Je n'aime pas" actionListener="#{beanMedia.jeNAimePas}" update="messages, avis" icon="ui-icon-heart" disabled="#{beanMedia.jeNAimePasDisabled}" />  
	    </p:splitButton>
	    
	    <p:splitButton id="ajouteA" value="Ajouter à" icon="ui-icon-plus" style="font-size: 11px;">  
	        <p:menuitem id="favori" value="#{beanMedia.txtFavori}" actionListener="#{beanMedia.ajouterAFavori}" update="messages, ajouteA" icon="ui-icon-star" />
	        <p:menuitem value="Playlist" update="messages" icon="ui-icon-video" onclick="dlgPlaylist.show();" />  
	    </p:splitButton>
		
		<p:splitButton value="Partager" icon="ui-icon-home" style="font-size: 11px;">  
	        <p:menuitem value="Exporter" update="messages" icon="ui-icon-copy" onclick="dlgExporter.show();" />
	        <p:menuitem value="Emails et amis" update="messages" icon="ui-icon-mail-open" onclick="dlgEmail.show();" />  
	    </p:splitButton>
    </h:form>
    	
		
			
			<!--<a4j:outputPanel ajaxRenderer="true">
			<rich:notify id="notifyJAime" stayTime="1500" sticky="false" nonblocking="true"
				nonblockingOpacity="0.5" showShadow="false"
				showCloseButton="true" detail="#{beanMedia.detailNotificationJAime}" render="false"
				>
				<f:facet name="summary">
					J'aime ce contenu
				</f:facet>
			</rich:notify>
			</a4j:outputPanel>-->
			
			
			
				<!--<rich:notify id="notifyJeNAimePas" stayTime="1500" sticky="false" nonblocking="false"
					nonblockingOpacity="0.5" showShadow="false"
					showCloseButton="true" detail="#{beanMedia.detailNotificationJeNAimePas}">
				 	<f:facet name="summary">
						Je n'aime pas ce contenu
					</f:facet>
				</rich:notify>-->
			
			
			<!--<rich:notify id="notifyFavori" stayTime="1500" sticky="false" nonblocking="false"
					nonblockingOpacity="0.5" showShadow="false"
					showCloseButton="true" detail="Média ajouté à vos favoris">
				 
					<f:facet name="summary">
						Favori
					</f:facet>
				</rich:notify>-->
				
	
    <br />    
    
    		<!-- Pop-up permettant l'ajout du média à une playlist -->			
			<!--<rich:popupPanel id="popupPlaylist" modal="false" autosized="true" resizeable="false" style="z-index: 99999;">-->
		    <p:dialog id="popupPlaylist" header="Ajouter à une playlist" widgetVar="dlgPlaylist" showEffect="explode" hideEffect="bounce">
		        <h:form id="formPlaylist">
		        <p>
		        	<h:outputText value="Cliquez sur une playlist pour ajouter ou retirer ce média" />
		        	 <p:dataTable id="dataTable" var="play" value="#{beanMedia.listePlaylistUt}">  
				        <f:facet name="header">
				            <h:outputText value="Playlists" />
				        </f:facet>  
				  
				        <p:column id="nomPlaylist" sortBy="#{play.nomPlaylist}"><!-- TODO sort -->
				            <f:facet name="header">  
				                <h:outputText value="Nom" />  
				            </f:facet>
				            <h:graphicImage id="imgAjoutPlaylist" value="../resources/images/icones/#{beanMedia.imgAjoutPlaylist}" alt="Ajouter" />
	        				<p:commandLink update="@form" actionListener="#{beanMedia.ajouterMediaAPlaylist}" style="margin-right:23px;">  
						        <h:outputText value="#{play.nomPlaylist} (nb de média dans playlist TODO)" />
						    	<f:setPropertyActionListener target="#{beanMedia.playlistSelectionne}" value="#{play.nomPlaylist}" />
						    </p:commandLink>
						    
							
							<p:commandButton value="test" update=":formPlaylist" actionListener="#{beanMedia.ajouterMediaAPlaylist}" style="margin-right:23px;">  
						        <f:setPropertyActionListener target="#{beanMedia.playlistSelectionnee}" value="#{play}" />
						    </p:commandButton>
				        </p:column>
				        
				        <p:column id="visibilitePlaylist" sortBy="#{play.visibilite}">  
				            <f:facet name="header">
				                <h:outputText value="Visibilité" />  
				            </f:facet>
				            <h:outputText value="#{play.visibilite.nomVisibilite}" />
				        </p:column>
				    </p:dataTable>
		            <br />
		            <p:commandButton value="Créer une playlist" onclick="dlgCreerPlaylist.show(); dlgPlaylist.hide();" type="button" />
		            <!-- Collector XXX -->
		            <br />
		        </p>
		        </h:form>
		    <!--</rich:popupPanel>-->
		    </p:dialog>
		    
		    
		    <h:form>
	        <!-- Pop-up permettant la création d'une nouvelle playlist -->
	        <!--<rich:popupPanel id="popupCreerPlaylist" modal="false" autosized="true" resizeable="false" style="z-index: 99999;">-->
			<p:dialog id="popupCreerPlaylist" header="Créer une nouvelle playlist" widgetVar="dlgCreerPlaylist" showEffect="explode" hideEffect="bounce">
  				<p:panel id="panel" style="margin-bottom:10px;">
			        <p:messages id="messages" />  
			        <h:panelGrid columns="3">  
			            <h:outputLabel for="nomPlaylistACreer" value="Nom : *" />  
			            <p:inputText id="nomPlaylistACreer"   
			                value="#{beanMedia.nomPlaylistACreer}" required="true" label="Nom">  
			                <f:validateLength minimum="1" />  
			            </p:inputText>  
			            <p:message for="nomPlaylistACreer" />  
			              
			            <h:outputLabel for="visibilitePlaylistACreer" value="Visibilité : *" />  
			            <p:selectOneMenu id="visibilitePlaylistACreer" value="#{beanMedia.visibilitePlaylistACreer}">
					    	<f:selectItems value="#{beanMedia.listeNomVisibilite}" />
					    </p:selectOneMenu>
					    <p:message for="visibilitePlaylistACreer" />
			            
			            <h:outputLabel for="descrPlaylistACreer" value="Description :" />  
		           		<p:inputTextarea id="descrPlaylistACreer" rows="5" cols="30" counter="counter" maxlength="100"       
						    counterTemplate="{0} caractères restants." autoResize="false" value="#{beanMedia.descriptionPlaylistACreer}" />
						<h:outputText id="counter" /><!-- FIXME caractères restants -->
			        </h:panelGrid>
			  	</p:panel>
			  	
			    <p:commandButton value="Sauvegarder" id="Sauvegarder"  
			    	actionListener="#{beanMedia.creerPlaylist}" oncomplete="dlgCreerPlaylist.hide(); dlgPlaylist.show();" />
		    <!--</rich:popupPanel>-->
	        </p:dialog>
	        </h:form>
	        
	        
	                
        	<!-- Pop-up permettant d'exporter le média --> 
        	   <!--<rich:popupPanel id="popupExporter" modal="false" autosized="true" resizeable="false" style="z-index: 99999;">-->
			    <p:dialog id="popupExporter" header="Personnaliser le lecteur exportable" widgetVar="dlgExporter" showEffect="explode" hideEffect="bounce" width="480">
			    	<h:form id="formExporter">
			        	<h:outputText value="Lien : " styleClass="bold"/>
			        	<br />
			        	<p:inputText id="lien" value="#{request.requestURL}" size="58" />
			        	<br />
			        	<br />			        	
			        	<hr />
			        	<br />
			        	<h:outputText value="Copier le code d'intégration" styleClass="bold" />
			        	<br />
			        	<p:inputTextarea id="codeIntegration" value="#{beanMedia.codeIntegration}" cols="60" rows="5">
			        	</p:inputTextarea>
			        	<br />
			        	<h:outputText value="Après avoir sélectionné les options souhaitées plus bas, copiez-collez le code d'intégration ci-dessus. Ce dernier change en fonction des options choisies." />
			        	<br />
			        	<hr />
			        	<p:selectBooleanCheckbox value="true">  
				            <p:ajax event="change" update="formExporter codeIntegration" listener="#{beanMedia.desactiverLecteurIframe}"/>  
				        </p:selectBooleanCheckbox><!-- TODO update -->
				        <h:outputText value="Utiliser l'ancien code d'intégration" />
			        	<br />
			        	<hr />
			        	<br />
			        	<h:outputText value="Taille du lecteur" styleClass="bold"/>
			        	<br />
			        	<p:selectOneRadio id="tailleLecteur" 
							value="#{beanMedia.tailleLecteur}" layout="lineDirection">
							<f:ajax event="change" upddate="formExporter codeIntegration" listener="#{beanMedia.changerTailleLecteur}"></f:ajax>
							<f:selectItem id="petit" itemLabel="Petit (320x180)" itemValue="petit" />
							<f:selectItem id="moyen" itemLabel="Moyen (480x270)" itemValue="moyen" />
							<f:selectItem id="grand" itemLabel="Grand (560x315)" itemValue="grand" />							
			        	</p:selectOneRadio><!--TODO update--><!-- execute="@form"  -->
			        	<!--<f:selectItem id="personnalisee" itemLabel="Taille personnalisée" itemValue="taillePersonnalisee" /> XXX-->
			        	<!--<p:selectManyCheckbox value="#{beanMedia.tailleLecteur}" update="codeIntegration">
				            <f:selectItem itemLabel="Petit (320x180)" itemValue="petit" />
				            <f:selectItem itemLabel="Moyen (480x270)" itemValue="moyen" />
				            <f:selectItem itemLabel="Grand (560x315)" itemValue="grand" />
				            <f:selectItem itemLabel="Taille personnalisée" itemValue="taillePersonnalisee" />
				        </p:selectManyCheckbox>-->
				        <!--Intro, Titre, Résumé XXX-->
			        	<br />
			   		</h:form>
			    <!--</rich:popupPanel>-->
			    </p:dialog>
			    
			    <!-- Pop-up permettant d'envoyer un email -->
			    <p:dialog id="popupEmail" header="Choisissez vos destinataires" widgetVar="dlgEmail" showEffect="explode" hideEffect="bounce"><!-- TODO à ouvrir -->
			        
					<h:form id="formNouveauMessage">
					
						<h:panelGrid columns="2" columnClasses="top,top">
							<h:outputText value="De : " />
							<p:inputText
								value="#{beanMessagesPrives.utilisateurConnecte.adrMail}"
								style="width: 500px" disabled="true" />
	
							<h:outputText value=" A : " />
							<p:autoComplete id="destinataire" maxResults="5"
								value="#{beanMessagesPrives.destinataire}"
								styleClass="message_automplete"
								completeMethod="#{beanMessagesPrives.autoCompletion}"
								style="width: 500px" />
	
							<h:outputText value=" Objet : " />
							<p:inputText id="objet" value="#{beanMessagesPrives.objet}"
								style="width: 500px" />
	
							<h:outputText value="Message :" />
							<p:editor id="editorNouveauMessage"
								value="#{beanMessagesPrives.contenu}" width="500" height="250" />
	
						</h:panelGrid>
	
						<br />
	
						<p:commandButton value="Envoyer le message"
							action="#{beanMessagesPrives.envoyerEmail}"
							onclick="dlgNouveauMessage.hide()">
						</p:commandButton>
					</h:form>
			    </p:dialog>
			    
			    <!-- Indication si le média est aimé ou non -->
			    
			    
				<br />
        		<br />
			    
			    <!-- Réseaux sociaux -->
	            <div style="float: left;">
	            <!-- https://dev.twitter.com/docs/tweet-button : Tweet Button -->
				<a href="https://twitter.com/share" class="twitter-share-button" data-via="twitterapi" data-lang="en">Tweet</a>
				<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
				</div>
				
				<!-- Like Button - Facebook Developers -->
				<!--<div style="float: left; max-width: 100px;" class="fb-like" data-send="false" data-layout="button_count" data-width="450" data-show-faces="true"></div>-->
				<div style="float: left; max-width: 100px;" class="fb-like" data-href="http://88.191.133.150:8080/MediArea/" data-send="false" data-layout="button_count" data-width="450" data-show-faces="true"></div>
				
				<div style="float: left;">
					<!-- https://developers.google.com/+/plugins/+1button/ ; http://www.google.com/intl/en/webmasters/+1/button/ : +1 Button -->
					<div class="g-plusone" data-href="http://88.191.133.150:8080/MediArea/"></div>
				</div>
				
				<div style="float: left;">
					<!-- http://en.skyrock.com/developer/tools.php : Share on Skyrock -->
					<a href="http://www.skyrock.com/m/blog/share.php?js=0" class="skysocial-s skyrocksocialshare_classic24" title="Share on Skyrock" style="display:inline-block;text-indent:-999em;overflow:hidden;width:57px;height:24px;background:url(http://share.static.skyrock.net/img/api/skyrocksocialshare_classic24.png) no-repeat 0 0 transparent;"><p style="display:none;">Share on Skyrock</p></a>
					<script>(function(){var d=document,id='skyrock-fxlebpx'; if(d.getElementById(id)) return;var e=d.createElement('script');e.id=id;e.async=true;e.src='http://share.static.skyrock.net/js/skyrock_social.min.js';d.getElementsByTagName('body')[0].appendChild(e);}());</script>
					<!-- FIXME -->
				</div>
				
				<div style="clear: both;"></div>
				<br />
			
	            
	            <!-- Informations sur le média -->
	            <span class="bold">
	            	<h:outputText value="Ajouté par " />
	            	<h:outputLink value="" action="">
						<h:outputText value="#{beanMedia.auteur}" />
					</h:outputLink>
	            	<h:outputText value=" le #{beanMedia.datePublication}" />
	            </span>
	            <br />
	            <h:outputText value="#{beanMedia.description}" />
        	<!-- </rich:panel> -->
        	</p:fieldset>
        	
        	<!-- Partie droite -->
        	<p:fieldset styleClass="droite">
        		<!-- Affichage du nombre de vues -->
        		<h:outputText value="#{beanMedia.resultatTotalVuesMedia}">
        			<f:convertNumber integerOnly="true" />
        		</h:outputText>
        		<h:outputText value=" vue#{beanMedia.motVues}" />
        		
				        
				<br />   
				<!-- Affichage du nombre de fois que le média a été téléchargé -->     		
		        <h:outputText value="#{beanMedia.resultatTotalTelechargementMedia} téléchargement#{beanMedia.motTelechargement}" />
		        <br />
		        <br />  
        		
        	<!-- Notation par estimation étoile du média -->
        	<h:form>
        		<div style="float:left;">
        		<p:growl id="messages" showDetail="true" />
        	
        		<h:panelGrid columns="2" cellpadding="5">
			        <p:rating value="#{beanMedia.note}">  
			            <p:ajax event="rate" listener="#{beanMedia.handleRate}" update="messages" />  
			        </p:rating>
			    </h:panelGrid>
        		</div>
        	</h:form>
        		<br />
        		<br />
        	<h:form>	
        		<div style="float:left;">
        			<h:commandButton value="Exporter" image="/resources/images/icones/tag-icone-4783-32.png" alt="Exporter" onclick="dlgExporter.show();" title="Exporter ce média sur votre blog ou site" /><!-- TODO a4j -->
        			<p:spacer width="20" />
        			<!-- Affichage des statistiques associés au média -->
        			<p:commandButton value="Visualiser statistiques" image="/resources/images/icones/graphique-en-ligne-icone-4887-32.png" alt="Statistiques" onclick="dlgStatistiques.show();" title="Statistiques" />
        			<p:spacer width="20" />
        			<!-- Signalement du média -->
        			<p:commandButton value="Signaler" image="/resources/images/icones/drapeau-rouge-icone-6492-32.png" alt="Peut offenser" onclick="dlgSignaler.show();" title="Signaler ce média" />
	            </div>
	        </h:form>
	            
	            <!-- Pop-up permettant de visualiser les statistiques du média -->
        		<h:form>	        		
	        		<p:dialog id="popupStatistiques" header="Statistiques" widgetVar="dlgStatistiques" showEffect="explode" hideEffect="bounce">
				        <h:outputText value="#{beanMedia.resultatTotalVuesMedia} vue#{beanMedia.motVues} - "/> 
				        <h:outputText value="#{beanMediaCommentaire.nbCommentaires} com. - " />
				        <h:outputText value="TODO fav. - " />
				        <h:outputText value="#{beanMedia.resultatTotalVotesMedia} vote#{beanMedia.motVotes}"/>
				        <br />  
						<h:outputText value="Utilisateurs ayant aimé : " /><h:outputText value="#{beanMedia.resultatNbAime}" />
						
						<br />
						<h:outputText value="Utilisateurs n'ayant pas aimé : " /><h:outputText value="#{beanMedia.resultatNbNAimePas}" />
						<br />
						<p:barChart id="graphiqueAimeNAimePas" value="#{beanMedia.graphiqueAimeNAimePas}" legendPosition="se" style="height:300px"  
            				title="Avis des utilisateurs" orientation="horizontal" min="0" max="200"/><!-- TODO pq rechargement de la page qd ajout de barChart ? -->
						<br />
						<h:panelGroup rendered="#{beanMedia.resultatTotalVuesMedia > 0 }">
							<p:lineChart id="graphiqueStatVues" value="#{beanMedia.graphiqueStatVues}" legendPosition="e"  
								title="Statistiques sur le nombre de vues" minY="0" maxY="#{beanMedia.maxY}" style="height:300px;margin-top:20px; width: 500px" /> 
					        <!-- Audiences par nb de vues (dernière heure, dernier jour, dernier mois) par sexe et âge, par endroit XXX -->
				        </h:panelGroup>
				    </p:dialog>
				</h:form>
				
				<!-- Pop-up permettant de signaler un média -->        		
        		<p:dialog id="popupSignaler" header="Signaler ce média (contenu pouvant offenser)" widgetVar="dlgSignaler" showEffect="explode" hideEffect="bounce" width="480">
			    	<h:form id="formSignaler">
			       	<p:messages id="messagesSignalementMedia" showDetail="true" autoUpdate="true"/>
			        <p>
			        	<h:outputText value="Décrivez la raison qui décrit le mieux le problème lié au média. Nous procéderons à un examen afin de déterminer si celle-ci enfreint le Règlement de la communauté ou si elle risque d'offenser certaines personnes. L'usage abusif de cette fonctionnalité constitue également une violation du Règlement de la communauté. Ne l'utilisez pas de manière inadéquate." />
			        </p>
			        <p>
						<h:outputText value="Raison du signalement : " styleClass="bold" />
						<br />
						<p:inputTextarea id="raisonSignalementMedia" rows="5" cols="60" counter="counter" maxlength="100"       
						    counterTemplate="{0} caractères restants." autoResize="false" value="#{beanMedia.raisonMedia}" required="true"/>  
						  
						<h:outputText id="counter" />
						<p:message for="raisonSignalementMedia" /><!-- TODO required raison -->
						<!-- ou Motif du signalement (liste déroulante) -->
			       	</p>
			       	<p>
	           			<p:commandButton value="Envoyer le rapport" update="formSignaler" actionListener="#{beanMedia.signalerMedia}"/>
			       	</p>
			       	<!-- Pouvoir signaler un média même si l'utilisateur n'est pas connecté (formulaire avec champs nom, prénom, ...) XXX -->
			    	</h:form>
			    </p:dialog>
			    
			    <br /><br />
        		
        		<!-- Artiste : <h:outputText value="" /><br /> XXX -->
        		
        		<!-- Ajout au panier du média -->
        		<h:form>
        			<p:commandButton value="Ajouter #{beanMedia.titreMedia} au panier" title="Ajouter #{beanMedia.titreMedia} au panier" actionListener="#{beanPanier.ajouterAuPanier}" image="/resources/images/icones/panier-ajouter-icone-5924-32.png" rendered="#{beanMedia.mediaVisualise.estTelechargementAutorise}" />
					<!--<rich:notify id="notifyAjoutAuPanier" stayTime="1500" sticky="false" nonblocking="false"
			        nonblockingOpacity="0.5" showShadow="false"
			        showCloseButton="true" detail="#{beanPanier.detailNotifyAjoutAuPanier}">			 
				        <f:facet name="summary">
				            Notification
				        </f:facet>			        
			        </rich:notify>-->
		        </h:form>
        		
        		<!-- Téléchargement du média -->
        		<h:form>
	        		<p:commandLink id="downloadLink" value="Télécharger ce média" ajax="false" actionListener="#{beanMedia.telechargerMedia}" rendered="#{beanMedia.mediaVisualise.estTelechargementAutorise}">  
					    <p:fileDownload value="#{beanMedia.file}" />  
					</p:commandLink>
					<br />
					<p:commandLink id="downloadLinké" value="Télécharger ce média" actionListener="#{beanMedia.telechargerMedia}" rendered="#{beanMedia.mediaVisualise.estTelechargementAutorise}">  
					    <p:fileDownload value="#{beanMedia.file}" />  
					</p:commandLink>
        		</h:form>
	         
	         	
        	</p:fieldset>
        	
        	<div style="clear: both;"></div>
			
			<div style="clear: both;"></div>

			<!-- Plus -->
			<p:fieldset legend="Plus" toggleable="true" toggleSpeed="500">
				<h:panelGroup rendered="#{beanConnexion.user != beanMedia.mediaVisualise.auteurMedia}">
					<!-- Affichage des catégories associées au média -->
					<h:graphicImage value="/resources/images/icones/documents-tiroirs-classeurs-icone-6679-16.png" />
                    <h:outputText value=" Catégories : " styleClass="bold" />
					<br />
					<ui:repeat value="#{beanMedia.listeNomCategories}" var="categ"
						rows="20" id="repeatCategories">
						<h:outputLink value="recherche.jsf?categ=#{categ}"
							title="#{categ}">
							<h:outputText value="#{categ}" />
						</h:outputLink>
					</ui:repeat>
	
					<br />
					<br />
	
					<!-- Affichage des tags associés au média -->
					<h:graphicImage value="/resources/images/icones/tag-pink-icone-4864-16.png" />
					<h:outputText value=" Tags : " styleClass="bold" />
					<br />
					<p:tagCloud model="#{beanMedia.tagCloud}" />
					
					<br />
					
					<!--<p:commandButton value="Modifier" update="formTagsCategories" />
					Champs deviennent éditables au clic sur le bouton Modifier TODO-->
             				
				</h:panelGroup>
				
				
				<!-- Modification des catégories et tags si c'est le propriétaire du média qui visualise le média -->
				<h:panelGroup rendered="#{beanConnexion.user == beanMedia.mediaVisualise.auteurMedia}">
					<h:form id="formTagsCategories">
						<h:outputText value="Catégorie : " styleClass="bold" />
						<br />
						<p:inputTextarea value="#{beanMedia.listeNomCategories}" cols="80" />
						
						<br />
						<br />
		
						<h:outputText value="Tags : " styleClass="bold" />
						<br />
						<p:inputTextarea value="#{beanMedia.listeNomTags}" cols="80" />
					
						<br />
						<br />
						
						<p:commandButton value="Enregistrer les modifications" update="formTagsCategories" id="enregistrerModif"  
             				actionListener="#{beanMedia.modifierCategoriesTags}" />
					</h:form>
				</h:panelGroup>
			</p:fieldset>
		    
			<br />
			<br />
			
			<!-- Carousel des médias suggérés ayant le même artiste que le média visualisé -->
			<h:panelGroup rendered="#{not empty beanMedia.carouselRecommendationMedias}">
						<p:carousel value="#{beanMedia.carouselRecommendationMedias}" var="mediaRecommende" itemStyleClass="carItem"  
			            			easing="easeOutBounce" style="min-width: 600px;">
						    <h:panelGrid columns="1" style="width: 200px"  cellpadding="5">
						        <p:graphicImage value="../resources/#{mediaRecommende.photo}"/> <!-- TODO bon chemin -->  
						          
						        <h:outputText value="#{mediaRecommende.titreMedia}" styleClass = "bold" />  
						          
						        <h:outputText value="de #{mediaRecommende.auteurMedia.nomUtilisateur}" />
						          
						        <!--<h:outputText value="Nb vues : " /> XXX-->
						    </h:panelGrid>
						</p:carousel>
					</h:panelGroup>
			
			<br />
			<br />
			<br />
			
			
			
			
			
			
			<ui:include src="detailMediaCommentaires.xhtml" />
			
			
			
			
			
			
			
		</section>
		
		
		
		
		<!-- Suggestions de médias -->
		<aside class="group2">
			<h3>
				<h:outputText value="Suggestions" />
			</h3>
			<article class="holder_news">
				<h:form>
			                <ui:repeat value="#{beanMediaSuggestions.listeMediasSuggeres}" var="mediaSuggere" rows="20"
			                    id="repeat">
			                        <p:panelGrid id="gridSuggestions" style="width: 274px;"> 
			                        	<p:row>
       										<p:column rowspan="3">
       											<h:graphicImage library="images" name="#{mediaSuggere.photo.cheminPhotoCouverture}"  width="100" height="59" alt="#{mediaSuggere.photo.nomPhotoCouverture}" style="float: left;" />       											
				                        	</p:column>
			                        	</p:row>
				                        <p:row>
				                        	<p:column>
				                        		<h:outputLink value="TODO">
				                        			<h:outputText value="#{mediaSuggere.titreMedia}" />
				                        		</h:outputLink>
				                        		<br />
						                        <h:outputText value="de " />
						                        <h:outputLink value="TODO/#{mediaSuggere.auteurMedia.pseudo}">
							                    	<h:outputText value="#{mediaSuggere.auteurMedia.pseudo}" style="font-weight:bold;" />
												</h:outputLink>
							                    <br />
							                    <h:outputText value="... vues" /><!-- TODO -->
						                    </p:column>
					                    </p:row>
        							</p:panelGrid>
			                    <br />
			                </ui:repeat>
			            	<h:outputLink value="recherche.jsf?TODO">
								<h:outputText value="" style="font-weight:bold;" />
							</h:outputLink>
							<p:commandButton value="Afficher plus de suggestions" 
            					ajax="false" /><!-- actionListener="" redirection vers recherche.jsf TODO -->
			    </h:form>
			</article> 
		</aside>
	</ui:define>
</ui:composition> 
</html>
<!-- multilangue XXX -->