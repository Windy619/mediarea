<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
	  xmlns:a4j="http://richfaces.org/a4j"
	  xmlns:rich="http://richfaces.org/rich"> 
      
<ui:composition template="/templates/standard.xhtml">
		
	<ui:define name="pageTitle">Amis</ui:define>
	<ui:define name="content">
		<section class="group1">
			<h3>Amis</h3>  							      
		    
		    <br />	
		    <h:outputText rendered="#{empty beanAmis.utilisateurConnecte}" value="Vous devez être connecté pour accèder à ces informations" />
		    
		        			
			<h:form rendered="#{not empty beanAmis.utilisateurConnecte}">
				<rich:message for="rechercheUtilisateur" />
				<h:outputLabel value="Recherche utilisateur : " />
				<h:inputText value="#{beanAmis.rechercheUtilisateur}" id="rechercheUtilisateur" />
				<h:commandButton value="Recherche" action="#{beanAmis.rechercherUtilisateur}" />
			</h:form>
						
			<br />
						
		    <rich:panel rendered="#{beanAmis.panelRechercheAffiche and not empty beanAmis.utilisateurConnecte}">
		    
		        <f:facet name="header">
		            <h:outputText value="Liste utilisateur"></h:outputText>
		        </f:facet>
		        
		       
		            <rich:dataGrid value="#{beanAmis.resultatsRechercheUtilisateur}" var="utilisateur"
		                columns="#{beanAmis.nbColonneRecherche}" elements="20" border="0">
		                
		                <rich:panel>
		                    <f:facet name="header">
		                        <h:outputText value="#{utilisateur.pseudo}"></h:outputText>
		                    </f:facet>
		                    <h:panelGrid columns="2">
		                        <h:graphicImage value="#{utilisateur.avatar.nomAvatar}" />
		                        
		                        <br />
		                        
		                        <h:form>
	                        		<h:commandButton value="Ajouter" action="#{beanAmis.ajouterAmis}" render="gridMesAmis" >
	                        			<f:setPropertyActionListener target="#{beanAmis.nouvelAmis}" value="#{utilisateur}" />  
	                        		</h:commandButton>
	                        	</h:form>
		                        			                        		                        	                     		                        	
		                    </h:panelGrid>
		                </rich:panel>
		                
		                <f:facet name="footer">
		                    <rich:dataScroller />
		                </f:facet>
		                
		            </rich:dataGrid>            
		        	<br />
 			        <h:outputText value="Utilisateurs trouvés : #{beanAmis.nombreUtilisateursTrouves} " />
		    </rich:panel>
           		    
			<br />
			
			<h:form rendered="#{not empty beanAmis.utilisateurConnecte}">
				<h:commandButton action="#{beanAmis.chargerSuggestion}" value="Afficher une suggestion d'utilisateur"/>
			</h:form>
			
			<br />
			
		    <rich:panel name="panelSuggestion" rendered="#{beanAmis.panelSuggestionAffiche and not empty beanAmis.utilisateurConnecte}">
		    
		        <f:facet name="header">
		            <h:outputText value="Suggestion d'ajout :"></h:outputText>
		        </f:facet>
		        
		       
		            <rich:dataGrid value="#{beanAmis.suggestionUtilisateurs}" var="suggestion"
		                columns="#{beanAmis.nbColonneSuggestion}" elements="20" border="0">
		                
		                <rich:panel>
		                    <f:facet name="header">
		                        <h:outputText value="#{suggestion.ami.pseudo}"></h:outputText>
		                    </f:facet>
		                    <h:panelGrid columns="2">
		                        <h:graphicImage value="#{suggestion.ami.avatar.nomAvatar}" />
		                        
		                        <br />
		                        
		                        <h:form>
	                        		<h:commandButton value="Ajouter" action="#{beanAmis.ajouterAmis}" render="gridMesAmis" >
	                        			<f:setPropertyActionListener target="#{beanAmis.nouvelAmis}" value="#{suggestion.ami}" />  
	                        		</h:commandButton>
	                        	</h:form>
		                        			                        		                        	                     		                        	
		                    </h:panelGrid>
		                </rich:panel>
		                
		                <f:facet name="footer">
		                    <rich:dataScroller />
		                </f:facet>
		                
		            </rich:dataGrid>            
		        	<br />
 			        <h:outputText value="Nombre de suggestion trouvés : #{beanAmis.nombreSuggestions} " />
		    </rich:panel>			
    			
    		<br />
    		
			<h:form rendered="#{not empty beanAmis.utilisateurConnecte}">
				<h:commandButton action="#{beanAmis.cacherSuggestion}" value="Cacher les suggestions" rendered="#{beanAmis.panelSuggestionAffiche}"/>
			</h:form>
			
			<br />
			    					
		</section>
		
	    <aside class="group2">
			<h3>Ma liste d'amis</h3>
			
			<br />
			<h:outputText rendered="#{empty beanAmis.utilisateurConnecte}" value="Vous devez être connecté pour avoir des amis !" />
			
			<h:form rendered="#{not empty beanAmis.utilisateurConnecte}">
				<rich:message for="rechercheAmis" />
				<h:inputText value="#{beanAmis.rechercheAmis}" id="rechercheAmis" />
				<h:commandButton value="Recherche" action="#{beanAmis.rechercherAmis}" />
			</h:form>
			
			<br />
						
			<article class="holder_news">
	            <rich:dataGrid name="gridMesAmis" value="#{beanAmis.resultatsRechercheAmis}" var="amis"
	                columns="2" elements="20" width="600px" border="0" rendered="#{not empty beanAmis.utilisateurConnecte}">
	                <rich:panel>
	                    <f:facet name="header">
	                        <h:outputText value="#{amis.ami.pseudo}"></h:outputText>
	                    </f:facet>
	                    <h:panelGrid columns="1">                   		
	                        <h:graphicImage value="#{amis.ami.avatar.nomAvatar}" />
	                        
                        	<br />
                        	<h:outputText value="Depuis :" /> 
	                        <h:outputText value="#{amis.dateAmitie}" >
	                        	<f:convertDateTime locale="fr_FR" dateStyle="short" type="date"/>
	                        </h:outputText>
	                        
	                        <br />
	                        <h:form>
                        		<h:commandButton value="Supprimer" action="#{beanAmis.supprimerAmis}" render="gridMesAmis" >
                        			<f:setPropertyActionListener target="#{beanAmis.ancienAmis}" value="#{amis}" />  
                        		</h:commandButton>
                        	</h:form>
                        	                        	
	                    </h:panelGrid>
	                </rich:panel>
	                <f:facet name="footer">
	                    <rich:dataScroller />
	                </f:facet>
	            </rich:dataGrid>
	            <br />
	            <h:outputText value="Vous avez #{beanAmis.nombreAmis} amis" rendered="#{not empty beanAmis.utilisateurConnecte}" />
	            <br />
	            <br />
				<h:form rendered="#{not empty beanAmis.utilisateurConnecte}">
					<h:commandButton value="Afficher tous" action="#{beanAmis.chargerAmis}" />
				</h:form>	            
			</article>				
		</aside>		
	</ui:define>
</ui:composition> 
</html>
 